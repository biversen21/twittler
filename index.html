<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
		<script src='moment.js'></script>
		<link rel="Stylesheet" href='styles.css' type='text/css'>
  </head>
  <body>
		<h1 class='title'>Twittler App</h1>
		
		<div class='feedContainer'>
			<h4 class='feedTitle'>Tweet Feed</h4>
			<div class='feedButtons'>
				<button type='button' class='feedBtn'>Full Feed</button>
				<button type='button' class='autoBtn'>Autoload</button>
				<button type='button' class='stopBtn'>Stop Autoload</button>
			</div>
			<div class='container'></div>
		</div>
				
		<div class='newTweetContainer'>
			<h4 class='newTweetTitle'>Add New Tweet</h4>
			<div class='addNewTweet'>
				<textarea type='text' name='newTweet' placeholder='Enter Tweet Here' rows='4' cols='40'></textarea>
				<button type='button'>Post Tweet</button>
			</div>
		</div>
    <script>

      $(document).ready(function(){
        var $body = $('.container');
        $body.html('');
				var timer;
				
				// Function to load tweets
				var newTweets = function() {
					$body.html('');
	        var index = streams.home.length - 1;
					var origIndex = index;
	        while(index >= 0){
	          var tweet = streams.home[index];
	          var $tweet = $("<div></div>");
						var $user = $('<a/>', {
						          html: '@' + tweet.user + ': ',
						          id: tweet.user,
						          href: "#"
						          });
	          var $content = (tweet.message + "<strong class='timestamp'> posted: " + moment(tweet.created_at).fromNow() + '</strong>');
						$tweet.append($user);
						$tweet.append($content);
	          $tweet.appendTo($body);
	          index -= 1;
					}
				}
				
				var addProfileTweets = function(username) {
					var $profile = $('.container');
					$profile.html('');
					var index = streams.users[username].length - 1;
					while(index >= 0) {
						var tweet = streams.users[username][index];
						var $tweet = $("<div></div>");
						var $user = $('<a/>', {
						          html: '@' + tweet.user + ': ',
						          id: tweet.user,
						          href: "#"
						          });
	          var $content = (tweet.message + "<strong class='timestamp'> posted: " + moment(tweet.created_at).fromNow() + '</strong>');
						$tweet.append($user);
						$tweet.append($content);
						$tweet.appendTo($profile);
						index -= 1;
					}
				}
				
				var autoTweet = function() {
					newTweets()
					timer = setTimeout(autoTweet, 1);
				}
				
				var stopTweets = function() {
					clearTimeout(timer);
				}
				
				newTweets();	// Initial invoke upon page load
				
				$('.feedBtn').on('click', newTweets);
				$('.autoBtn').on('click', autoTweet);
				$('.stopBtn').on('click', stopTweets);
				$('div a').click(function() {
					var user = $(this).attr('id');
					addProfileTweets(user);
					console.log(user);
				})
      });

    </script>
  </body>
</html>